<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Aurora Backend â€” Pagination Tester</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; max-width: 980px; margin: 24px auto; padding: 0 12px; }
    header { display: flex; gap: 12px; align-items: end; flex-wrap: wrap; }
    label { display: grid; gap: 4px; font-size: 14px; }
    input, select, button { font-size: 14px; padding: 6px 8px; }
    button { cursor: pointer; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    #out { white-space: pre; background: #0b1020; color: #d6ffea; padding: 12px; border-radius: 8px; overflow:auto; }
    .muted { color: #666; font-size: 13px; }
  </style>
</head>
<body>
  <h1>Pagination Tester</h1>
  <p class="muted">Use this to manually test pagination on your endpoints with real Next/Prev buttons.</p>

  <header>
    <label>
      Endpoint
      <select id="endpoint">
        <option value="projects">/aurora/projects</option>
        <option value="designs">/aurora/projects/:projectId/designs</option>
        <option value="search">/search</option>
        <option value="modules">/aurora/modules</option>
        <option value="inverters">/aurora/inverters</option>
        <option value="dc_optimizers">/aurora/dc-optimizers</option>
      </select>
    </label>

    <label id="project-wrap" style="display:none;">
      projectId (for designs)
      <input id="projectId" placeholder="paste a real project id" />
    </label>

    <label id="q-wrap" style="display:none;">
      q (for search)
      <input id="q" placeholder="e.g. rail" />
    </label>

    <label id="page-wrap">
      page
      <input id="page" type="number" value="1" min="1" />
    </label>

    <label id="pagesize-wrap">
      page_size / per_page / limit
      <input id="pageSize" type="number" value="5" min="1" />
    </label>

    <label id="cursor-wrap" style="display:none;">
      cursor (components only)
      <input id="cursor" placeholder="autofilled on next" />
    </label>

    <div style="display:flex; gap:8px;">
      <button id="load">Load</button>
      <button id="prev">Prev</button>
      <button id="next">Next</button>
    </div>
  </header>

  <p class="muted" id="hint"></p>

  <h3>Response</h3>
  <div id="out"></div>

  <script>
    const el = (id) => document.getElementById(id);

    const endpoint = el("endpoint");
    const projectWrap = el("project-wrap");
    const qWrap = el("q-wrap");
    const cursorWrap = el("cursor-wrap");
    const pageWrap = el("page-wrap");
    const pageSizeWrap = el("pagesize-wrap");
    const projectId = el("projectId");
    const q = el("q");
    const page = el("page");
    const pageSize = el("pageSize");
    const cursor = el("cursor");
    const out = el("out");
    const hint = el("hint");

    function updateUI() {
      const ep = endpoint.value;
      projectWrap.style.display = ep === "designs" ? "block" : "none";
      qWrap.style.display = ep === "search" ? "block" : "none";
      // cursor is only for components (modules/inverters/dc_optimizers)
      cursorWrap.style.display = (ep === "modules" || ep === "inverters" || ep === "dc_optimizers") ? "block" : "none";
      // page vs limit
      pageWrap.style.display = (ep === "modules" || ep === "inverters" || ep === "dc_optimizers") ? "none" : "block";
      pageSizeWrap.querySelector("label");
      hint.innerText =
        ep === "projects" ? "Uses page & per_page" :
        ep === "designs" ? "Uses page & per_page; requires a projectId" :
        ep === "search" ? "Uses page & page_size; optional q" :
        "Components use limit (+ optional cursor for next page)";
    }

    endpoint.addEventListener("change", updateUI);
    updateUI();

    function buildURL(dir) {
      const base = window.location.origin;
      const ep = endpoint.value;
      if (ep === "projects") {
        const p = Number(page.value || 1);
        const per = Number(pageSize.value || 10);
        const newPage = dir === "next" ? p + 1 : dir === "prev" ? Math.max(1, p - 1) : p;
        page.value = newPage;
        return `${base}/aurora/projects?page=${newPage}&per_page=${per}`;
      }
      if (ep === "designs") {
        const pid = projectId.value.trim();
        if (!pid) { alert("Enter a projectId from /aurora/projects"); throw new Error("no projectId"); }
        const p = Number(page.value || 1);
        const per = Number(pageSize.value || 10);
        const newPage = dir === "next" ? p + 1 : dir === "prev" ? Math.max(1, p - 1) : p;
        page.value = newPage;
        return `${base}/aurora/projects/${encodeURIComponent(pid)}/designs?page=${newPage}&per_page=${per}`;
      }
      if (ep === "search") {
        const p = Number(page.value || 1);
        const per = Number(pageSize.value || 10);
        const newPage = dir === "next" ? p + 1 : dir === "prev" ? Math.max(1, p - 1) : p;
        page.value = newPage;
        const query = encodeURIComponent(q.value || "");
        return `${base}/search?q=${query}&page=${newPage}&page_size=${per}`;
      }
      // components (limit + cursor)
      const limit = Number(pageSize.value || 5);
      if (ep === "modules") return `${base}/aurora/modules?limit=${limit}` + (dir === "next" && cursor.value ? `&cursor=${encodeURIComponent(cursor.value)}` : "");
      if (ep === "inverters") return `${base}/aurora/inverters?limit=${limit}` + (dir === "next" && cursor.value ? `&cursor=${encodeURIComponent(cursor.value)}` : "");
      if (ep === "dc_optimizers") return `${base}/aurora/dc-optimizers?limit=${limit}` + (dir === "next" && cursor.value ? `&cursor=${encodeURIComponent(cursor.value)}` : "");
      return base;
    }

    async function fetchAndRender(url) {
      out.textContent = "Loading...";
      const r = await fetch(url);
      const data = await r.json();
      out.textContent = JSON.stringify(data, null, 2);

      // For component endpoints, capture next_cursor automatically
      if (data && typeof data === "object") {
        if ("next_cursor" in data && data.next_cursor) {
          cursor.value = data.next_cursor;
        } else if ("next_cursor" in data) {
          cursor.value = ""; // clear if none
        }
      }
    }

    el("load").addEventListener("click", () => fetchAndRender(buildURL(null)));
    el("next").addEventListener("click", () => fetchAndRender(buildURL("next")));
    el("prev").addEventListener("click", () => fetchAndRender(buildURL("prev")));
  </script>
</body>
</html>
